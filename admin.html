<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Admin Evoluwill</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BBH+Bartle&display=swap" rel="stylesheet"> <!-- Certifique-se de que o link est√° correto -->
  <link rel="icon" href="img/Ellipse 1.png" type="img/icon">
</head>
<body class="page-light">
  <header class="app-header">
    <div class="app-header-inner">
      <div class="logo">
          <div class="logo-nome"><h1>Evoluwill</h1></div>
      </div>
       <!-- ECG decorativo (batimentos) -->
    <div class="header-ecg" aria-hidden="true">
      <svg viewBox="0 0 520 60" role="presentation" focusable="false">
        <path class="ecg-path ecg-track" d="M0 30 L60 30 L80 30 L95 30 L110 30 L125 30 L140 30 L160 30 L180 30 L200 30 L220 30 L240 30 L260 30 L280 30 L300 30 L320 30 L340 30 L360 30 L380 30 L400 30 L420 30 L440 30 L460 30 L520 30" />
        <g class="ecg-move">
          <path class="ecg-path" d="M0 30 L55 30 L70 30 L82 10 L94 50 L108 22 L120 30 L160 30 L175 30 L187 18 L198 42 L212 30 L260 30 L315 30 L330 30 L342 10 L354 50 L368 22 L380 30 L520 30" />
          <path class="ecg-path" d="M520 30 L575 30 L590 30 L602 10 L614 50 L628 22 L640 30 L680 30 L695 30 L707 18 L718 42 L732 30 L780 30 L835 30 L850 30 L862 10 L874 50 L888 22 L900 30 L1040 30" />
        </g>
      </svg>
    </div>

      <nav class="top-nav">
        <a href="admin.html" class="nav-link active">Painel ADM</a>
        <a href="relatorios.html" class="nav-link">Relat√≥rios</a>
        <button id="btnExportar">Exportar Chamados (CSV)</button>
      </nav>
    </div>
  </header>

  <main class="main-container admin-layout">
    <!-- Coluna de Chamados -->
    <section class="column">
      <header class="section-header">
        <h1>PAINEL DE CHAMADOS</h1>
        <div class="section-actions">
          <span class="badge" id="totalChamadosBadge">0 chamados</span>
          <!-- NOVO: contagem por nome filtrado -->
          <span class="badge" id="contagemNomeBadge" style="display:none;">0 chamados para nome</span>
        </div>
      </header>

      <div class="filter-bar">
        <select id="statusFiltro" class="input-pill">
          <option value="TODOS">Todos os status</option>
          <option value="Em Espera">Em Espera</option>
          <option value="Em atendimento">Em atendimento</option>
          <option value="Resolvido">Resolvido</option>
          <option value="Cancelado">Cancelado</option>
          <!-- NOVO STATUS -->
          <option value="Verificando com a GTI">Verificando com a GTI</option>
          <option value="Em Produ√ß√£o">Em Produ√ß√£o</option>
        </select>

        <!-- NOVO: filtro por nome especificamente -->
        <input type="text" id="filtroNome" class="input-pill" placeholder="Filtrar por nome" />

        <input type="text" id="buscaTexto" class="input-pill" placeholder="Buscar por nome ou assunto" />
      </div>

      <div id="chamadosContainer" class="cards-grid">
        <!-- Cards de chamados ser√£o inseridos via JS -->
      </div>
    </section>

    <!-- Coluna de Logs -->
    <section class="column logs-column">
      <header class="section-header">
        <h2>Logs do Sistema</h2>
      </header>

      <div class="filter-bar">
        <input type="datetime-local" id="logDataInicio" class="input-pill" />
        <input type="datetime-local" id="logDataFim" class="input-pill" />
        <button id="filtrarLogsBtn" class="btn btn-secondary btn-small">Filtrar</button>
      </div>

      <div class="logs-table-wrapper">
        <table class="logs-table">
          <thead>
          <tr>
            <th>Data/Hora</th>
            <th>A√ß√£o</th>
            <th>ID Chamado</th>
            <th>Ator</th>
            <th>Detalhes</th>
          </tr>
          </thead>
          <tbody id="logsTableBody">
          <!-- Linhas via JS -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Modal de detalhes do chamado -->
  <div id="detalheChamadoModal" class="modal-overlay hidden">
    <div class="modal modal-large">
      <header class="modal-header">
        <span class="pill pill-primary" id="modalProtocolo">CH-0000</span>
        <button class="modal-close-btn" id="detalheFecharBtn">√ó</button>
      </header>

      <div class="modal-body">
        <div class="modal-grid">
          <div>
            <div class="field-row">
              <span class="field-label">Data de abertura</span>
              <span class="field-value" id="modalDataAbertura"></span>
            </div>
            <div class="field-row">
              <span class="field-label">Tempo de abertura</span>
              <span class="field-value" id="modalTempoAbertura"></span>
            </div>
          </div>

          <div>
            <div class="field-row">
              <span class="field-label">Status</span>
              <select id="modalStatus" class="input-pill">
                <option value="Em Espera">Em Espera</option>
                <option value="Em atendimento">Em atendimento</option>
                <option value="Resolvido">Resolvido</option>
                <option value="Cancelado">Cancelado</option>
                <!-- NOVO STATUS -->
                <option value="Verificando com a GTI">Verificando com a GTI</option>
                <option value="Em Produ√ß√£o">Em Produ√ß√£o</option>
              </select>
            </div>
          </div>
        </div>

        <!-- NOVO GRID: Nome + Categoria (telefone removido) -->
        <div class="modal-grid">
          <div>
            <div class="field-row">
              <span class="field-label">Nome do solicitante</span>
              <input id="modalNome" class="input-underline" />
            </div>
          </div>
          <div>
            <div class="field-row">
              <span class="field-label">Categoria</span>
              <select id="modalCategoria" class="input-underline">
                <option value="">Selecione</option>
                <option value="Melhoria Dedalus">Melhoria Dedalus</option>
                <option value="Melhoria IRIS">Melhoria IRIS</option>
                <option value="Melhoria Genesys">Melhoria Genesys</option>
                <option value="Erro de Integra√ß√£o">Erro de Integra√ß√£o</option>
                <option value="Erro de App Token">Erro de App Token</option>
                <option value="Erro no Fechamento">Erro no Fechamento</option>
                <option value="Cadastro Estabelecimento">Cadastro Estabelecimento</option>
                <option value="Treinamento Fornecedor">Treinamento Fornecedor</option>
                <option value="Treinamento Solicitante">Treinamento Solicitante</option>
                <option value="Fornecedor com dificuldade">Fornecedor com dificuldade</option>
                <option value="Agendamento">Agendamento</option>
                <option value="D√∫vidas">D√∫vidas</option>
                </select>
            </div>
          </div>
        </div>

        <!-- NOVO: Urg√™ncia (somente aqui, telefone foi removido) -->
        <div class="field-row">
          <span class="field-label">Urg√™ncia</span>
          <select id="modalUrgencia" class="input-pill">
            <option value="">Selecione...</option>
            <option value="Vermelho - MUITO GRAVE">Vermelho - MUITO GRAVE</option>
            <option value="Laranja - Resolu√ß√£o para hoje Entre 09h as 17h">
            Laranja - Resolu√ß√£o para hoje Entre 09h as 17h
            </option>
            <option value="Amarelo - At√© 2 dias">Amarelo - At√© 2 dias</option>
            <option value="Verde - At√© 10 dias">Verde - At√© 10 dias</option>
            <option value="Azul - Demanda Agendada">Azul - Demanda Agendada</option>
          </select>
        </div>

        <div class="field-row">
          <span class="field-label">Assunto</span>
          <input id="modalAssunto" class="input-underline" />
        </div>

        <div class="field-row">
          <span class="field-label">Descri√ß√£o</span>
          <textarea id="modalDescricao" rows="4"></textarea>
        </div>

        <div class="field-row">
          <span class="field-label">Anexo</span>
          <div id="modalAnexoContainer" class="attachment-box">
            <!-- Preenchido via JS -->
          </div>
        </div>

        <!-- CHAT / COMENT√ÅRIOS (ADM / USU√ÅRIO) -->
        <div class="comments-section">
          <div class="comments-header">
            <h3 class="comments-title">Mensagens com o usu√°rio</h3>
          </div>
          <div id="adminCommentsList" class="comments-list">
            <!-- Coment√°rios ser√£o carregados via JS -->
          </div>
          <div class="comments-input-row">
            <textarea
              id="adminNewComment"
              placeholder="Escreva uma mensagem para o usu√°rio..."
            ></textarea>
            <button id="adminSendCommentBtn" class="btn btn-primary btn-small">
              Enviar
            </button>
          </div>
        </div>
      </div>

      <footer class="modal-footer">
        <button id="modalExcluirBtn" class="btn btn-danger">Excluir</button>
        <button id="modalSalvarBtn" class="btn btn-primary">Salvar altera√ß√µes</button>
      </footer>
    </div>
  </div>

  <!-- Modal de confirma√ß√£o de exclus√£o -->
  <div id="confirmDeleteModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-icon">üóëÔ∏è</div>
      <h3>Excluir chamado</h3>
      <p>Tem certeza que deseja excluir este chamado? Esta a√ß√£o n√£o poder√° ser desfeita.</p>
      <div class="modal-footer">
        <button id="confirmDeleteCancelBtn" class="btn btn-secondary">N√£o, cancelar</button>
        <button id="confirmDeleteOkBtn" class="btn btn-danger">Sim, excluir</button>
      </div>
    </div>
  </div>

  <!-- Modal de alerta simples -->
  <div id="adminAlertModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-icon">‚ö†Ô∏è</div>
      <h3 id="adminAlertTitle">Erro</h3>
      <p id="adminAlertMessage"></p>
      <button id="adminAlertCloseBtn" class="btn btn-secondary">Fechar</button>
    </div>
  </div>

  <!-- Modal para motivo de finaliza√ß√£o (j√° existia, mantido igual) -->
  <div id="finalizarModal" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-icon">‚úÖ</div>
      <h3>Finalizar chamado</h3>
      <p class="small muted">
        Informe um breve motivo para a finaliza√ß√£o. Esse texto ser√° salvo nos coment√°rios do chamado
        e ficar√° vis√≠vel para o usu√°rio na √°rea de acompanhamento.
      </p>
      <textarea id="finalizarMotivo" rows="3" style="width:100%; margin-top:0.5rem;"></textarea>
      <div class="modal-footer">
        <button id="finalizarCancelarBtn" class="btn btn-secondary">Cancelar</button>
        <button id="finalizarConfirmarBtn" class="btn btn-primary">Finalizar chamado</button>
      </div>
    </div>
  </div>

  <!-- NOVO: LOADING GLOBAL PARA TODAS AS OPERA√á√ïES ASS√çNCRONAS NO ADMIN -->
  <div id="globalLoading" class="modal-overlay hidden">
    <div class="modal">
      <div class="modal-icon">‚è≥</div>
      <h3>Processando...</h3>
      <p class="small muted">Aguarde enquanto aplicamos as altera√ß√µes.</p>
    </div>
  </div>

  <script type="module" src="js/admin.js"></script>
  <!-- Carrega o script que faz a exporta√ß√£o -->
  <script type="module" src="js/exportar.js"></script>s
</body>
</html>
